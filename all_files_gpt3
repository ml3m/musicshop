package com.musicshop.models;

public class AlbumTest {
}
package com.musicshop.models;

public class InstrumentTest {
}
package com.musicshop.services;

import com.musicshop.models.Album;
import com.musicshop.models.Instrument;
import com.musicshop.models.MusicItem;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

class InventoryServiceImplTest {
    private InventoryServiceImpl inventoryService;

    @BeforeEach
    void setUp() {
        inventoryService = new InventoryServiceImpl();
    }

    @Test
    void testAddItem() {
        MusicItem guitar = new Instrument("Guitar", 150.0, "String");
        inventoryService.addItem(guitar);

        List<MusicItem> items = inventoryService.getItems();
        assertEquals(1, items.size());
        assertEquals("Guitar", items.get(0).getName());
    }

    @Test
    void testRemoveItem() {
        MusicItem piano = new Instrument("Piano", 1000.0, "Percussion");
        inventoryService.addItem(piano);
        inventoryService.removeItem("Piano");

        List<MusicItem> items = inventoryService.getItems();
        assertTrue(items.isEmpty());
    }

    @Test
    void testGetItems() {
        inventoryService.addItem(new Album("Thriller", 15.0, "Michael Jackson", 1982));
        inventoryService.addItem(new Instrument("Drums", 200.0, "Percussion"));

        List<MusicItem> items = inventoryService.getItems();
        assertEquals(2, items.size());
    }
}
package com.musicshop.services;

import com.musicshop.models.Album;
import com.musicshop.models.Instrument;
import com.musicshop.models.MusicItem;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.File;
import java.util.ArrayList;
import java.util.List;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

class FileStorageServiceTest {
    private FileStorageService fileStorageService;
    private InventoryServiceImpl inventoryService;
    private static final String TEST_FILE_PATH = "test_inventory.json";

    @BeforeEach
    void setUp() {
        fileStorageService = new FileStorageService();
        inventoryService = new InventoryServiceImpl();
    }

    @Test
    void testSaveAndLoadItems() {
        List<MusicItem> items = new ArrayList<>();
        items.add(new Album("Test Album", 10.0, "Test Artist", 2021));
        items.add(new Instrument("Violin", 120.0, "String"));

        // Save to file
        fileStorageService.saveItems(items);

        // Load from file
        inventoryService.clearItems();
        fileStorageService.loadItems(inventoryService);
        List<MusicItem> loadedItems = inventoryService.getItems();

        assertEquals(2, loadedItems.size());
        assertEquals("Test Album", loadedItems.get(0).getName());
        assertEquals("Violin", loadedItems.get(1).getName());

        // Clean up test file
        new File(TEST_FILE_PATH).delete();
    }
}
package com.musicshop.services;

import com.musicshop.exceptions.InvalidItemException;
import com.musicshop.models.Album;
import com.musicshop.models.MusicItem;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

class MusicServiceImplTest {
    private InventoryServiceImpl inventoryService;
    private MusicServiceImpl musicService;

    @BeforeEach
    void setUp() {
        inventoryService = new InventoryServiceImpl();
        musicService = new MusicServiceImpl(inventoryService);
    }

    @Test
    void testAddItem() throws InvalidItemException {
        MusicItem album = new Album("Back in Black", 15.0, "AC/DC", 1980);
        musicService.addItem(album);

        List<MusicItem> items = inventoryService.getItems();
        assertEquals(1, items.size());
        assertEquals("Back in Black", items.get(0).getName());
    }

    @Test
    void testRemoveItem() throws InvalidItemException {
        MusicItem album = new Album("Greatest Hits", 10.0, "Queen", 1981);
        musicService.addItem(album);

        musicService.removeItem("Greatest Hits");
        List<MusicItem> items = inventoryService.getItems();
        assertTrue(items.isEmpty());
    }

    @Test
    void testRemoveNonexistentItem() {
        assertThrows(InvalidItemException.class, () -> musicService.removeItem("Nonexistent"));
    }
}
package com.musicshop;

import com.musicshop.models.Album;
import com.musicshop.models.Instrument;
import com.musicshop.models.MusicItem;
import com.musicshop.services.InventoryServiceImpl;
import com.musicshop.services.MusicServiceImpl;
import com.musicshop.exceptions.InvalidItemException;

import java.util.InputMismatchException;
import java.util.List;
import java.util.Scanner;

public class MainMenu {
    private final MusicServiceImpl musicService;
    private final InventoryServiceImpl inventoryService;
    private final Scanner scanner;

    public MainMenu(MusicServiceImpl musicService, InventoryServiceImpl inventoryService) {
        this.musicService = musicService;
        this.inventoryService = inventoryService;
        this.scanner = new Scanner(System.in);
    }

    public void start() {
        boolean running = true;
        while (running) {
            showMenu();
            int choice = getUserChoice();
            switch (choice) {
                case 1 -> addItem();
                case 2 -> removeItem();
                case 3 -> viewItems();
                case 0 -> {
                    System.out.println("Exiting program...");
                    running = false;
                }
                default -> System.out.println("Invalid option. Please try again.");
            }
        }
    }

    private void showMenu() {
        System.out.println("\n--- Music Shop Management System ---");
        System.out.println("1. Add Item to Inventory");
        System.out.println("2. Remove Item from Inventory");
        System.out.println("3. View Inventory");
        System.out.println("0. Exit");
        System.out.print("Select an option: ");
    }

    private int getUserChoice() {
        try {
            return scanner.nextInt();
        } catch (InputMismatchException e) {
            scanner.next();  // Clear invalid input
            System.out.println("Invalid input. Please enter a number.");
            return -1;
        }
    }

    private void addItem() {
        System.out.println("Choose item type: 1. Instrument  2. Album");
        int type = getUserChoice();
        scanner.nextLine();  // Consume newline

        try {
            if (type == 1) {
                System.out.print("Enter Instrument name: ");
                String name = scanner.nextLine();
                System.out.print("Enter Instrument price: ");
                double price = scanner.nextDouble();
                scanner.nextLine();  // Consume newline

                MusicItem instrument = new Instrument(name, price);
                musicService.addItem(instrument);
                System.out.println("Instrument added to inventory.");

            } else if (type == 2) {
                System.out.print("Enter Album name: ");
                String name = scanner.nextLine();
                System.out.print("Enter Album price: ");
                double price = scanner.nextDouble();
                scanner.nextLine();  // Consume newline
                System.out.print("Enter Album artist: ");
                String artist = scanner.nextLine();
                System.out.print("Enter Album release year: ");
                int releaseYear = scanner.nextInt();

                MusicItem album = new Album(name, price, artist, releaseYear);
                musicService.addItem(album);
                System.out.println("Album added to inventory.");
            } else {
                System.out.println("Invalid item type selected.");
            }
        } catch (InvalidItemException | InputMismatchException e) {
            System.out.println("Failed to add item: " + e.getMessage());
            scanner.nextLine();  // Clear invalid input if any
        }
    }

    private void removeItem() {
        System.out.print("Enter name of the item to remove: ");
        scanner.nextLine();  // Consume newline
        String itemName = scanner.nextLine();

        try {
            musicService.removeItem(itemName);
            System.out.println("Item removed from inventory.");
        } catch (InvalidItemException e) {
            System.out.println("Error: " + e.getMessage());
        }
    }

    private void viewItems() {
        List<MusicItem> items = inventoryService.getItems();
        if (items.isEmpty()) {
            System.out.println("Inventory is empty.");
        } else {
            System.out.println("\n--- Inventory List ---");
            items.forEach(System.out::println);
        }
    }
}
package com.musicshop.models;

import com.fasterxml.jackson.annotation.JsonTypeInfo;
import com.fasterxml.jackson.annotation.JsonSubTypes;

@JsonTypeInfo(
    use = JsonTypeInfo.Id.NAME,
    include = JsonTypeInfo.As.PROPERTY,
    property = "type"
)
@JsonSubTypes({
    @JsonSubTypes.Type(value = Album.class, name = "album"),
    @JsonSubTypes.Type(value = Instrument.class, name = "instrument")
})
public abstract class MusicItem {
    protected String name;
    protected double price;

    public MusicItem(String name, double price) {
        this.name = name;
        this.price = price;
    }

    public String getName() {
        return name;
    }

    public double getPrice() {
        return price;
    }

    @Override
    public String toString() {
        return "Name: " + name + ", Price: $" + price;
    }
}
package com.musicshop.models;

public class Customer {
    private String id;
    private String name;

    public Customer(String id, String name) {
        this.id = id;
        this.name = name;
    }

    public String getId() {
        return id;
    }

    public String getName() {
        return name;
    }

    @Override
    public String toString() {
        return "ID: " + id + ", Name: " + name;
    }
}
package com.musicshop.models;

public class Album extends MusicItem {
    private String artist;
    private int year;

    // Default constructor for Jackson
    public Album() {
        super(null, 0.0);
    }

    public Album(String name, double price, String artist, int year) {
        super(name, price);
        this.artist = artist;
        this.year = year;
    }

    public String getArtist() {
        return artist;
    }

    public int getYear() {
        return year;
    }

    @Override
    public String toString() {
        return super.toString() + ", Artist: " + artist + ", Year: " + year;
    }
}
package com.musicshop.models;

public class Instrument extends MusicItem {
    private String type;

    // Default constructor for Jackson
    public Instrument() {
        super(null, 0.0);
    }

    public Instrument(String name, double price) {
        super(name, price);
    }

    @Override
    public String toString() {
        return super.toString() + ", Type: " + type;
    }
}
package com.musicshop.exceptions;

public class CustomerNotFoundException extends RuntimeException {
    public CustomerNotFoundException(String message) {
        super(message);
    }
}
package com.musicshop.exceptions;

public class InvalidItemException extends RuntimeException {
    public InvalidItemException(String message) {
        super(message);
    }
}
package com.musicshop;

import com.musicshop.services.FileStorageService;
import com.musicshop.services.InventoryServiceImpl;
import com.musicshop.services.MusicServiceImpl;

public class Main {
    public static void main(String[] args) {
        // Instantiate the file storage service
        FileStorageService fileStorageService = new FileStorageService();

        // Instantiate the inventory service with file storage for automatic load/save
        InventoryServiceImpl inventoryService = new InventoryServiceImpl(fileStorageService);

        // Instantiate the music service, passing the inventory service
        MusicServiceImpl musicService = new MusicServiceImpl(inventoryService);

        // Pass all services to MainMenu
        MainMenu mainMenu = new MainMenu(musicService, inventoryService);

        // Start the application
        mainMenu.start();
    }
}
package com.musicshop.services;

import com.musicshop.models.MusicItem;
import com.musicshop.exceptions.InvalidItemException;

public class MusicServiceImpl implements MusicService {
    private InventoryServiceImpl inventoryService;

    public MusicServiceImpl(InventoryServiceImpl inventoryService) {
        this.inventoryService = inventoryService;
    }

    @Override
    public void addItem(MusicItem item) {
        if (item == null || item.getPrice() < 0) {
            throw new InvalidItemException("Invalid item details");
        }
        inventoryService.addItem(item);
    }

    @Override
    public void removeItem(String itemName) {
        if (inventoryService.findItemByName(itemName) == null) {
            throw new InvalidItemException("Item not found in inventory");
        }
        inventoryService.removeItem(itemName);
    }
}

package com.musicshop.services;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.SerializationFeature;
import com.fasterxml.jackson.core.type.TypeReference;
import com.musicshop.models.MusicItem;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class FileStorageService {
    private static final String FILE_PATH = "inventory.json";
    private final ObjectMapper objectMapper;

    public FileStorageService() {
        objectMapper = new ObjectMapper();
        objectMapper.enable(SerializationFeature.INDENT_OUTPUT);
    }

    // Load items from JSON file
    public List<MusicItem> loadItems() {
        try {
            File file = new File(FILE_PATH);
            if (!file.exists()) {
                return new ArrayList<>();  // Return empty list if file doesn't exist
            }
            // Specify the type as List<MusicItem> to ensure correct deserialization of subtypes
            return objectMapper.readValue(file, new TypeReference<List<MusicItem>>() {});
        } catch (IOException e) {
            System.out.println("Error loading items from JSON: " + e.getMessage());
            return new ArrayList<>();  // Return empty list in case of error
        }
    }

    // Save items to JSON file
    public void saveItems(List<MusicItem> items) {
        try {
            objectMapper.writeValue(new File(FILE_PATH), items);
            System.out.println("Inventory saved to JSON file.");
        } catch (IOException e) {
            System.out.println("Error saving items to JSON: " + e.getMessage());
        }
    }

    // Append a single item to the existing JSON file contents
    public void appendItem(MusicItem newItem) {
        List<MusicItem> currentItems = loadItems(); // Load current items
        currentItems.add(newItem); // Add the new item
        saveItems(currentItems); // Save the updated list
    }

    // Clear all items in the JSON file
    public void clearAllItems() {
        saveItems(new ArrayList<>()); // Save an empty list to clear the file
    }
}
package com.musicshop.services;

import com.musicshop.models.MusicItem;

public interface MusicService {
    void addItem(MusicItem item);
    void removeItem(String itemName);
}
package com.musicshop.services;

import com.musicshop.models.MusicItem;
import java.util.List;

public interface InventoryService {
    List<MusicItem> getItems();
    MusicItem findItemByName(String name);
}
package com.musicshop.services;

import com.musicshop.models.MusicItem;
import java.util.ArrayList;
import java.util.List;

public class InventoryServiceImpl implements InventoryService {
    private final List<MusicItem> inventory;
    private final FileStorageService fileStorageService;

    public InventoryServiceImpl(FileStorageService fileStorageService) {
        this.inventory = new ArrayList<>();
        this.fileStorageService = fileStorageService;

        // Load items from JSON into memory on initialization
        List<MusicItem> loadedItems = fileStorageService.loadItems();
        inventory.addAll(loadedItems); // Populate in-memory inventory
    }

    @Override
    public List<MusicItem> getItems() {
        return new ArrayList<>(inventory);
    }

    @Override
    public MusicItem findItemByName(String name) {
        return inventory.stream()
                .filter(item -> item.getName().equalsIgnoreCase(name))
                .findFirst()
                .orElse(null);
    }

    public void addItem(MusicItem item) {
        inventory.add(item); 
        fileStorageService.appendItem(item); // Append single item to file
    }

    public void removeItem(String itemName) {
        inventory.removeIf(item -> item.getName().equalsIgnoreCase(itemName));
        fileStorageService.saveItems(inventory); // Save full inventory after removal
    }

    public void clearItems() {
        inventory.clear();
        fileStorageService.clearAllItems(); // Clear the JSON file
    }
}
